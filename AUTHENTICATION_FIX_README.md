# üîê –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –ø—Ä–æ–±–ª–µ–º–∏ –∑ –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—î—é

## üìã –û–ø–∏—Å –ø—Ä–æ–±–ª–µ–º–∏

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ —á–∞—Å—Ç–æ –≤–∏–±–∏–≤–∞—é—Ç—å—Å—è –∑ —Å–∏—Å—Ç–µ–º–∏ –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫—É –ª–æ–≥—ñ–Ω—É —á–µ—Ä–µ–∑ 12+ –≥–æ–¥–∏–Ω –∞–±–æ –Ω–∞–≤—ñ—Ç—å —á–∞—Å—Ç—ñ—à–µ.

**–ü—Ä–∏—á–∏–Ω–∏:**
1. ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—è JWT middleware - –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–ø—É—Å–∫–∞–≤ –≤—Å—ñ –∑–∞–ø–∏—Ç–∏
2. ‚ùå –í—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å refresh token –º–µ—Ö–∞–Ω—ñ–∑–º—É
3. ‚ùå –¢–æ–∫–µ–Ω –∑–∞–∫—ñ–Ω—á—É–≤–∞–≤—Å—è —á–µ—Ä–µ–∑ 7 –¥–Ω—ñ–≤ –±–µ–∑ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è
4. ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞ –æ–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫ 401
5. ‚ùå –í—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–æ–∫–µ–Ω–∞

## ‚úÖ –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è

### 1. **JWT Middleware** (`src/middleware/auth.ts`)
- ‚úÖ –î–æ–¥–∞–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω—É –ø–µ—Ä–µ–≤—ñ—Ä–∫—É JWT —Ç–æ–∫–µ–Ω—ñ–≤
- ‚úÖ –î–æ–¥–∞–Ω–æ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –≤ –±–∞–∑—ñ –¥–∞–Ω–∏—Ö
- ‚úÖ –î–æ–¥–∞–Ω–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è `lastActiveAt` –ø—Ä–∏ –∫–æ–∂–Ω–æ–º—É –∑–∞–ø–∏—Ç—ñ
- ‚úÖ –î–æ–¥–∞–Ω–æ –¥–µ—Ç–∞–ª—å–Ω—ñ –ø–æ–º–∏–ª–∫–∏ –∑ –∫–æ–¥–∞–º–∏

### 2. **AuthService** (`src/services/AuthService.ts`)
- ‚úÖ –î–æ–¥–∞–Ω–æ refresh token –º–µ—Ö–∞–Ω—ñ–∑–º
- ‚úÖ –î–æ–¥–∞–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–æ–∫–µ–Ω—ñ–≤
- ‚úÖ –î–æ–¥–∞–Ω–æ –≤–∞–ª—ñ–¥–∞—Ü—ñ—é —Ç–æ–∫–µ–Ω—ñ–≤
- ‚úÖ –î–æ–¥–∞–Ω–æ logout —Ñ—É–Ω–∫—Ü—ñ—é

### 3. **AuthController** (`src/controllers/authController.ts`)
- ‚úÖ –î–æ–¥–∞–Ω–æ logout endpoint
- ‚úÖ –î–æ–¥–∞–Ω–æ getProfile —Ç–∞ updateProfile
- ‚úÖ –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ refresh token endpoint
- ‚úÖ –î–æ–¥–∞–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω—É –æ–±—Ä–æ–±–∫—É –ø–æ–º–∏–ª–æ–∫

### 4. **Frontend AuthContext** (`web/src/contexts/AuthContext.tsx`)
- ‚úÖ –î–æ–¥–∞–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–æ–∫–µ–Ω–∞ –∑–∞ 5 —Ö–≤ –¥–æ –∑–∞–∫—ñ–Ω—á–µ–Ω–Ω—è
- ‚úÖ –î–æ–¥–∞–Ω–æ refresh token –ª–æ–≥—ñ–∫—É
- ‚úÖ –î–æ–¥–∞–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–µ –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è —Ç–æ–∫–µ–Ω—ñ–≤
- ‚úÖ –î–æ–¥–∞–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –ø—Ä–∏ –ø–æ–º–∏–ª–∫–∞—Ö

### 5. **API Service** (`web/src/services/api.ts`)
- ‚úÖ –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ refresh token endpoint
- ‚úÖ –î–æ–¥–∞–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–æ–∫–µ–Ω–∞ –ø—Ä–∏ 401
- ‚úÖ –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ URL endpoints (–ø—Ä–∏–±—Ä–∞–Ω–æ `/v1/`)

### 6. **–ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è** (`.env`)
- ‚úÖ –î–æ–¥–∞–Ω–æ `JWT_REFRESH_SECRET`
- ‚úÖ –î–æ–¥–∞–Ω–æ `JWT_REFRESH_EXPIRES_IN=30d`
- ‚úÖ –î–æ–¥–∞–Ω–æ security –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è

## üöÄ –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î —Ç–µ–ø–µ—Ä

### **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–æ–∫–µ–Ω–∞:**
1. **Access Token** –¥—ñ—î 7 –¥–Ω—ñ–≤
2. **Refresh Token** –¥—ñ—î 30 –¥–Ω—ñ–≤
3. **–ó–∞ 5 —Ö–≤–∏–ª–∏–Ω** –¥–æ –∑–∞–∫—ñ–Ω—á–µ–Ω–Ω—è access token –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è
4. **–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–µ –ø–æ–º—ñ—á–∞—î** –ø—Ä–æ—Ü–µ—Å –æ–Ω–æ–≤–ª–µ–Ω–Ω—è

### **–ë–µ–∑–ø–µ–∫–∞:**
- ‚úÖ –¢–æ–∫–µ–Ω–∏ –ø–µ—Ä–µ–≤—ñ—Ä—è—é—Ç—å—Å—è –ø—Ä–∏ –∫–æ–∂–Ω–æ–º—É –∑–∞–ø–∏—Ç—ñ
- ‚úÖ –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏—Ö–æ–¥–∏—Ç—å –ø—Ä–∏ –Ω–µ–¥—ñ–π—Å–Ω–æ–º—É refresh token
- ‚úÖ –û–Ω–æ–≤–ª—é—î—Ç—å—Å—è `lastActiveAt` –¥–ª—è –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞ –æ–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫ –∑ –¥–µ—Ç–∞–ª—å–Ω–∏–º–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è–º–∏

### **User Experience:**
- ‚úÖ **–ù–µ–º–∞—î —á–∞—Å—Ç–æ–≥–æ –≤–∏–±–∏–≤–∞–Ω–Ω—è** –∑ —Å–∏—Å—Ç–µ–º–∏
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è** —Å–µ—Å—ñ—ó
- ‚úÖ **–ü–ª–∞–≤–Ω–∞ —Ä–æ–±–æ—Ç–∞** –±–µ–∑ –ø–µ—Ä–µ—Ä–∏–≤–∞–Ω—å
- ‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è** –ø—Ä–æ –ø–æ–º–∏–ª–∫–∏

## üîß –¢–µ—Ö–Ω—ñ—á–Ω—ñ –¥–µ—Ç–∞–ª—ñ

### **JWT Payload:**
```json
{
  "id": "user-uuid",
  "iat": 1640995200,
  "exp": 1641600000
}
```

### **Refresh Token Payload:**
```json
{
  "id": "user-uuid",
  "iat": 1640995200,
  "exp": 1643587200
}
```

### **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è:**
```typescript
// –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –∫–æ–∂–Ω—É —Ö–≤–∏–ª–∏–Ω—É
const interval = setInterval(() => {
  const currentTime = Date.now();
  if (state.tokenExpiry && currentTime >= state.tokenExpiry - refreshThreshold) {
    refreshToken();
  }
}, 60000);
```

## üì± Endpoints

### **Public:**
- `POST /api/auth/register` - –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è
- `POST /api/auth/login` - –í—Ö—ñ–¥
- `POST /api/auth/refresh` - –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–æ–∫–µ–Ω–∞

### **Protected:**
- `POST /api/auth/logout` - –í–∏—Ö—ñ–¥
- `GET /api/auth/profile` - –ü—Ä–æ—Ñ—ñ–ª—å
- `PUT /api/auth/profile` - –û–Ω–æ–≤–ª–µ–Ω–Ω—è –ø—Ä–æ—Ñ—ñ–ª—é
- `PUT /api/auth/change-password` - –ó–º—ñ–Ω–∞ –ø–∞—Ä–æ–ª—è

## üß™ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

### **1. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è:**
```bash
# –õ–æ–≥—ñ–Ω–∏–º–æ—Å—å
curl -X POST http://localhost:3000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"test@example.com","password":"password123"}'

# –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ —Ç–æ–∫–µ–Ω
curl -H "Authorization: Bearer YOUR_TOKEN" \
  http://localhost:3000/api/auth/profile
```

### **2. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ refresh:**
```bash
curl -X POST http://localhost:3000/api/auth/refresh \
  -H "Content-Type: application/json" \
  -d '{"refreshToken":"YOUR_REFRESH_TOKEN"}'
```

## üö® –í–∞–∂–ª–∏–≤—ñ –º–æ–º–µ–Ω—Ç–∏

1. **–û–Ω–æ–≤—ñ—Ç—å .env —Ñ–∞–π–ª** –∑ –Ω–æ–≤–∏–º–∏ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è–º–∏
2. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç—ñ—Ç—å backend** –ø—ñ—Å–ª—è –∑–º—ñ–Ω
3. **–û—á–∏—Å—Ç—ñ—Ç—å localStorage** —É –±—Ä–∞—É–∑–µ—Ä—ñ –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è
4. **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ª–æ–≥–∏** backend –¥–ª—è –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç

**–î–æ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:**
- ‚ùå –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –≤–∏–±–∏–≤–∞–ª–∏—Å—è –∫–æ–∂–Ω—ñ 7 –¥–Ω—ñ–≤
- ‚ùå –ß–∞—Å—Ç—ñ –ø–æ–º–∏–ª–∫–∏ 401
- ‚ùå –ü–æ–≥–∞–Ω–∏–π user experience

**–ü—ñ—Å–ª—è –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:**
- ‚úÖ –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –∑–∞–ª–∏—à–∞—é—Ç—å—Å—è –≤ —Å–∏—Å—Ç–µ–º—ñ 30 –¥–Ω—ñ–≤
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–æ–∫–µ–Ω—ñ–≤
- ‚úÖ –ü–ª–∞–≤–Ω–∞ —Ä–æ–±–æ—Ç–∞ –±–µ–∑ –ø–µ—Ä–µ—Ä–∏–≤–∞–Ω—å
- ‚úÖ –ü—Ä–æ—Ñ–µ—Å—ñ–π–Ω–∏–π —Ä—ñ–≤–µ–Ω—å –±–µ–∑–ø–µ–∫–∏

---

**–ê–≤—Ç–æ—Ä:** AI Assistant  
**–î–∞—Ç–∞:** 22.08.2025  
**–í–µ—Ä—Å—ñ—è:** 1.0.0
