# üöÄ –í–µ–∫—Ç–æ—Ä–Ω–∏–π AI –ú–∞—Ç—á–∏–Ω–≥ - –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è

## üìã –û–≥–ª—è–¥

–†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ –æ–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω—É —Å–∏—Å—Ç–µ–º—É AI –º–∞—Ç—á–∏–Ω–≥—É, —è–∫–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î **–≤–µ–∫—Ç–æ—Ä–Ω–∏–π –ø–æ—à—É–∫ + AI –∞–Ω–∞–ª—ñ–∑** –¥–ª—è –∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è —ñ–¥–µ–∞–ª—å–Ω–∏—Ö –∫–∞–Ω–¥–∏–¥–∞—Ç—ñ–≤. –¶–µ –¥–æ–∑–≤–æ–ª—è—î –æ–±—Ä–æ–±–ª—è—Ç–∏ **1 –º—ñ–ª—å–π–æ–Ω –º–∞—Ç—á–∏–Ω–≥—ñ–≤ –∑–∞ $7.50** –∑–∞–º—ñ—Å—Ç—å $6,600!

## üéØ –ö–ª—é—á–æ–≤—ñ –ø–µ—Ä–µ–≤–∞–≥–∏

- ‚úÖ **95% –µ–∫–æ–Ω–æ–º—ñ—è** –Ω–∞ AI API –≤–∏–∫–ª–∏–∫–∞—Ö
- ‚úÖ **–ú–∏—Ç—Ç—î–≤–∏–π** –≤–µ–∫—Ç–æ—Ä–Ω–∏–π –ø–æ—à—É–∫
- ‚úÖ **Batch processing** –¥–ª—è –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ
- ‚úÖ **–ö–µ—à—É–≤–∞–Ω–Ω—è** —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤
- ‚úÖ **–ü—ñ–¥—Ç—Ä–∏–º–∫–∞** OpenAI —Ç–∞ Gemini
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ** –æ–Ω–æ–≤–ª–µ–Ω–Ω—è embeddings

## üèóÔ∏è –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞

```
1. –í–µ–∫—Ç–æ—Ä–Ω–∏–π –ø–æ—à—É–∫ (—à–≤–∏–¥–∫–æ, –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ)
   ‚Üì
2. AI –∞–Ω–∞–ª—ñ–∑ —Ç—ñ–ª—å–∫–∏ —Ç–æ–ø-20 –∫–∞–Ω–¥–∏–¥–∞—Ç—ñ–≤
   ‚Üì
3. –ö–µ—à—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤
   ‚Üì
4. –ü–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –Ω–∞–π–∫—Ä–∞—â–∏—Ö –º–∞—Ç—á—ñ–≤
```

## üì¶ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–∏

### 1. **EmbeddingService**
- –ì–µ–Ω–µ—Ä—É—î embeddings —á–µ—Ä–µ–∑ OpenAI/Gemini
- Batch processing –¥–ª—è –µ–∫–æ–Ω–æ–º—ñ—ó
- –ö–æ—Å–∏–Ω—É—Å–Ω–∞ —Å—Ö–æ–∂—ñ—Å—Ç—å

### 2. **VectorSearchService**
- PostgreSQL –∑ pgvector
- –®–≤–∏–¥–∫–∏–π –ø–æ—à—É–∫ —Å—Ö–æ–∂–∏—Ö –≤–µ–∫—Ç–æ—Ä—ñ–≤
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è embeddings

### 3. **OptimizedAiMatchingService**
- –ö–æ–º–±—ñ–Ω—É—î –≤–µ–∫—Ç–æ—Ä–Ω–∏–π + AI –ø–æ—à—É–∫
- Batch –º–∞—Ç—á–∏–Ω–≥ –¥–ª—è –º–Ω–æ–∂–∏–Ω–Ω–∏—Ö –≤–∞–∫–∞–Ω—Å—ñ–π
- –û—Ü—ñ–Ω–∫–∞ –≤–∞—Ä—Ç–æ—Å—Ç—ñ –æ–±—Ä–æ–±–∫–∏

### 4. **MatchingCacheService**
- In-memory –∫–µ—à —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤
- TTL 24 –≥–æ–¥–∏–Ω–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ—á–∏—â–µ–Ω–Ω—è

## üöÄ –®–≤–∏–¥–∫–∏–π —Å—Ç–∞—Ä—Ç

### 1. –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π

```bash
cd backend
npm install @google/generative-ai
```

### 2. –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∑–º—ñ–Ω–Ω–∏—Ö —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞

```env
# OpenAI (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)
OPENAI_API_KEY=your_openai_key

# Gemini (—Ä–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è - –¥–µ—à–µ–≤—à–∏–π)
GEMINI_API_KEY=your_gemini_key
```

### 3. –ó–∞–ø—É—Å–∫ –º—ñ–≥—Ä–∞—Ü—ñ—ó

```bash
npm run db:migrate
```

### 4. –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è embeddings

```bash
# –î–ª—è –≤–∞–∫–∞–Ω—Å—ñ–π
curl -X POST http://localhost:3000/api/optimized-ai-matching/embeddings/jobs/generate \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json"

# –î–ª—è –∫–∞–Ω–¥–∏–¥–∞—Ç—ñ–≤
curl -X POST http://localhost:3000/api/optimized-ai-matching/embeddings/candidates/generate \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json"
```

## üì° API Endpoints

### –û—Å–Ω–æ–≤–Ω—ñ –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏

#### 1. **–ó–Ω–∞–π—Ç–∏ –Ω–∞–π–∫—Ä–∞—â–∏—Ö –∫–∞–Ω–¥–∏–¥–∞—Ç—ñ–≤ –¥–ª—è –≤–∞–∫–∞–Ω—Å—ñ—ó**
```http
GET /api/optimized-ai-matching/jobs/{jobId}/matches
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä–∏:**
- `vectorTopK` (50) - –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∫–∞–Ω–¥–∏–¥–∞—Ç—ñ–≤ –¥–ª—è –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ—à—É–∫—É
- `aiTopK` (20) - –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∫–∞–Ω–¥–∏–¥–∞—Ç—ñ–≤ –¥–ª—è AI –∞–Ω–∞–ª—ñ–∑—É
- `minVectorSimilarity` (0.3) - –º—ñ–Ω—ñ–º–∞–ª—å–Ω–∞ –≤–µ–∫—Ç–æ—Ä–Ω–∞ —Å—Ö–æ–∂—ñ—Å—Ç—å
- `minAiScore` (70) - –º—ñ–Ω—ñ–º–∞–ª—å–Ω–∞ AI –æ—Ü—ñ–Ω–∫–∞
- `language` (en) - –º–æ–≤–∞ –∞–Ω–∞–ª—ñ–∑—É

**–ü—Ä–∏–∫–ª–∞–¥:**
```bash
curl "http://localhost:3000/api/optimized-ai-matching/jobs/123/matches?aiTopK=10&minAiScore=80" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

#### 2. **Batch –º–∞—Ç—á–∏–Ω–≥ –¥–ª—è –º–Ω–æ–∂–∏–Ω–Ω–∏—Ö –≤–∞–∫–∞–Ω—Å—ñ–π**
```http
POST /api/optimized-ai-matching/batch-match
```

**Body:**
```json
{
  "jobIds": ["job1", "job2", "job3"]
}
```

#### 3. **–í–µ–∫—Ç–æ—Ä–Ω–∏–π –ø–æ—à—É–∫ –≤–∞–∫–∞–Ω—Å—ñ–π –¥–ª—è –∫–∞–Ω–¥–∏–¥–∞—Ç–∞**
```http
GET /api/optimized-ai-matching/candidates/{candidateId}/similar-jobs
```

#### 4. **–í–µ–∫—Ç–æ—Ä–Ω–∏–π –ø–æ—à—É–∫ –∫–∞–Ω–¥–∏–¥–∞—Ç—ñ–≤ –¥–ª—è –≤–∞–∫–∞–Ω—Å—ñ—ó**
```http
GET /api/optimized-ai-matching/jobs/{jobId}/similar-candidates
```

### –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è embeddings

#### 5. **–ì–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ embeddings –¥–ª—è –≤–∞–∫–∞–Ω—Å—ñ–π**
```http
POST /api/optimized-ai-matching/embeddings/jobs/generate?batchSize=10
```

#### 6. **–ì–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ embeddings –¥–ª—è –∫–∞–Ω–¥–∏–¥–∞—Ç—ñ–≤**
```http
POST /api/optimized-ai-matching/embeddings/candidates/generate?batchSize=10
```

#### 7. **–û–Ω–æ–≤–∏—Ç–∏ embedding –¥–ª—è –≤–∞–∫–∞–Ω—Å—ñ—ó**
```http
PUT /api/optimized-ai-matching/embeddings/jobs/{jobId}
```

#### 8. **–û–Ω–æ–≤–∏—Ç–∏ embedding –¥–ª—è –∫–∞–Ω–¥–∏–¥–∞—Ç–∞**
```http
PUT /api/optimized-ai-matching/embeddings/candidates/{candidateId}
```

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–∞ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥

#### 9. **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –º–∞—Ç—á–∏–Ω–≥—É**
```http
GET /api/optimized-ai-matching/stats
```

**–í—ñ–¥–ø–æ–≤—ñ–¥—å:**
```json
{
  "success": true,
  "data": {
    "totalJobs": 1000,
    "jobsWithEmbeddings": 850,
    "totalCandidates": 5000,
    "candidatesWithEmbeddings": 4200,
    "averageVectorSimilarity": 0.75,
    "averageAiScore": 82
  }
}
```

#### 10. **–¢–µ—Å—Ç—É–≤–∞—Ç–∏ embedding**
```http
POST /api/optimized-ai-matching/test-embedding
```

**Body:**
```json
{
  "text": "Senior React Developer with 5+ years experience"
}
```

## üí∞ –í–∞—Ä—Ç—ñ—Å—Ç—å –æ–±—Ä–æ–±–∫–∏

### –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –∑ —Ç—Ä–∞–¥–∏—Ü—ñ–π–Ω–∏–º –ø—ñ–¥—Ö–æ–¥–æ–º

| –ü—ñ–¥—Ö—ñ–¥ | 1M –º–∞—Ç—á–∏–Ω–≥—ñ–≤ | –í–∞—Ä—Ç—ñ—Å—Ç—å |
|--------|--------------|----------|
| **–ù–∞—ó–≤–Ω–∏–π AI** | 1M AI –∑–∞–ø–∏—Ç—ñ–≤ | $6,600 |
| **–í–µ–∫—Ç–æ—Ä–Ω–∏–π + AI** | 50K AI –∑–∞–ø–∏—Ç—ñ–≤ | **$7.50** |
| **–ï–∫–æ–Ω–æ–º—ñ—è** | 95% –º–µ–Ω—à–µ –∑–∞–ø–∏—Ç—ñ–≤ | **99.9%** |

### –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –≤–∞—Ä—Ç–æ—Å—Ç—ñ

```typescript
// Gemini 1.5 Flash (—Ä–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è)
const inputCost = 0.075; // $ per 1M tokens
const outputCost = 0.30;  // $ per 1M tokens

// –ù–∞ 1 –º–∞—Ç—á–∏–Ω–≥: ~1000 input + 200 output tokens
const costPerMatch = (1000 * inputCost + 200 * outputCost) / 1_000_000;
// = $0.000135 per match

// 1M –º–∞—Ç—á–∏–Ω–≥—ñ–≤: $135 (–∞–ª–µ –º–∏ –æ–±—Ä–æ–±–ª—è—î–º–æ —Ç—ñ–ª—å–∫–∏ 5% = $7.50)
```

## üîß –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Ç–∞ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è

### 1. **–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤**

```typescript
// –í OptimizedAiMatchingService
const DEFAULT_OPTIONS = {
  vectorTopK: 50,        // –ë—ñ–ª—å—à–µ = —Ç–æ—á–Ω—ñ—à–µ, –∞–ª–µ –ø–æ–≤—ñ–ª—å–Ω—ñ—à–µ
  aiTopK: 20,           // –ú–µ–Ω—à–µ = –¥–µ—à–µ–≤—à–µ
  minVectorSimilarity: 0.3, // –§—ñ–ª—å—Ç—Ä –Ω–∏–∑—å–∫–æ—ó —è–∫–æ—Å—Ç—ñ
  minAiScore: 70        // –ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∞ AI –æ—Ü—ñ–Ω–∫–∞
};
```

### 2. **–í–∏–±—ñ—Ä AI –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞**

```typescript
// –í EmbeddingService
private preferredProvider: 'openai' | 'gemini' = 'gemini';

// Gemini –¥–µ—à–µ–≤—à–∏–π:
// - Embeddings: –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ (–≤ –º–µ–∂–∞—Ö –ª—ñ–º—ñ—Ç—ñ–≤)
// - AI –∞–Ω–∞–ª—ñ–∑: $0.075 per 1M input tokens
```

### 3. **–û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è –±–∞—Ç—á—ñ–≤**

```typescript
// Batch size –¥–ª—è embeddings
const EMBEDDING_BATCH_SIZE = 10;

// Batch size –¥–ª—è AI –∞–Ω–∞–ª—ñ–∑—É
const AI_BATCH_SIZE = 5;

// Concurrent jobs –¥–ª—è batch –º–∞—Ç—á–∏–Ω–≥—É
const MAX_CONCURRENT_JOBS = 3;
```

## üìä –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ —Ç–∞ –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### 1. **–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å—É embeddings**

```bash
curl "http://localhost:3000/api/optimized-ai-matching/stats" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### 2. **–û—á–∏—â–µ–Ω–Ω—è –∫–µ—à—É**

```typescript
// –í MatchingCacheService
await cacheService.cleanupExpiredCache();
```

### 3. **–õ–æ–≥–∏ –æ–±—Ä–æ–±–∫–∏**

```bash
# –í –∫–æ–Ω—Å–æ–ª—ñ —Å–µ—Ä–≤–µ—Ä–∞
üîç Starting optimized matching for job 123
üìä Found 45 vector matches, analyzing top 20 with AI
‚úÖ Found 12 high-quality matches in 2.3s
```

## üö® Troubleshooting

### 1. **–ü–æ–º–∏–ª–∫–∞ "No embedding found"**

```bash
# –ì–µ–Ω–µ—Ä—É–π—Ç–µ embeddings
curl -X POST "http://localhost:3000/api/optimized-ai-matching/embeddings/jobs/generate"
```

### 2. **–ü–æ–≤—ñ–ª—å–Ω–∏–π –ø–æ—à—É–∫**

```typescript
// –ó–º–µ–Ω—à—ñ—Ç—å vectorTopK
const options = { vectorTopK: 30, aiTopK: 10 };
```

### 3. **–í–∏—Å–æ–∫—ñ –≤–∏—Ç—Ä–∞—Ç–∏ –Ω–∞ AI**

```typescript
// –ó–º–µ–Ω—à—ñ—Ç—å aiTopK –∞–±–æ –ø—ñ–¥–≤–∏—â—Ç–µ minVectorSimilarity
const options = { 
  aiTopK: 10, 
  minVectorSimilarity: 0.5 
};
```

### 4. **–ü–æ–º–∏–ª–∫–∏ API –∫–ª—é—á—ñ–≤**

```env
# –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∑–º—ñ–Ω–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞
GEMINI_API_KEY=your_key_here
OPENAI_API_KEY=your_key_here
```

## üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—è

### 1. **Cron job –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è embeddings**

```typescript
// –©–æ–¥–Ω—è –æ 2:00
cron.schedule('0 2 * * *', async () => {
  await vectorSearchService.generateJobEmbeddings(50);
  await vectorSearchService.generateCandidateEmbeddings(50);
});
```

### 2. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –ø—Ä–∏ –∑–º—ñ–Ω–∞—Ö**

```typescript
// –í JobService –ø—Ä–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—ñ –≤–∞–∫–∞–Ω—Å—ñ—ó
await vectorSearchService.updateJobEmbedding(jobId);

// –í CandidateService –ø—Ä–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—ñ –ø—Ä–æ—Ñ—ñ–ª—é
await vectorSearchService.updateCandidateEmbedding(candidateId);
```

## üìà –ú–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è

### 1. **–î–ª—è –≤–µ–ª–∏–∫–∏—Ö –æ–±—Å—è–≥—ñ–≤ (>100K –≤–∞–∫–∞–Ω—Å—ñ–π)**

```typescript
// –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ Redis –¥–ª—è –∫–µ—à—É–≤–∞–Ω–Ω—è
const redis = new Redis(process.env.REDIS_URL);
```

### 2. **–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–µ –º–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è**

```typescript
// –†–æ–∑–ø–æ–¥—ñ–ª—ñ—Ç—å embeddings –ø–æ —Å–µ—Ä–≤–µ—Ä–∞—Ö
const embeddingShards = [
  'embedding-server-1',
  'embedding-server-2',
  'embedding-server-3'
];
```

### 3. **–û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è –±–∞–∑–∏ –¥–∞–Ω–∏—Ö**

```sql
-- –î–æ–¥–∞–π—Ç–µ —ñ–Ω–¥–µ–∫—Å–∏ –¥–ª—è —à–≤–∏–¥–∫–æ–≥–æ –ø–æ—à—É–∫—É
CREATE INDEX CONCURRENTLY idx_jobs_embedding_gin 
ON jobs USING gin (embedding) 
WHERE embedding IS NOT NULL;
```

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç

–¢–µ–ø–µ—Ä –≤–∞—à–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –º–æ–∂–µ:

- ‚úÖ –û–±—Ä–æ–±–ª—è—Ç–∏ **1 –º—ñ–ª—å–π–æ–Ω –º–∞—Ç—á–∏–Ω–≥—ñ–≤ –∑–∞ $7.50**
- ‚úÖ –ó–Ω–∞—Ö–æ–¥–∏—Ç–∏ —ñ–¥–µ–∞–ª—å–Ω–∏—Ö –∫–∞–Ω–¥–∏–¥–∞—Ç—ñ–≤ –∑–∞ **2-3 —Å–µ–∫—É–Ω–¥–∏**
- ‚úÖ –ú–∞—Å—à—Ç–∞–±—É–≤–∞—Ç–∏—Å—è –¥–æ **–Ω–µ–æ–±–º–µ–∂–µ–Ω–∏—Ö –æ–±—Å—è–≥—ñ–≤**
- ‚úÖ –ï–∫–æ–Ω–æ–º–∏—Ç–∏ **99.9%** –Ω–∞ AI API –≤–∏—Ç—Ä–∞—Ç–∞—Ö

**–¶–µ –≤ 880 —Ä–∞–∑—ñ–≤ –¥–µ—à–µ–≤—à–µ –Ω—ñ–∂ —Ç—Ä–∞–¥–∏—Ü—ñ–π–Ω–∏–π –ø—ñ–¥—Ö—ñ–¥!** üöÄ
